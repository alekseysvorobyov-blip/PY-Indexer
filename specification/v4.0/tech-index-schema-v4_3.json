{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TECH-INDEX v4.3",
  "description": "Compact hierarchical Python code index with enhanced type support and optimized structure",
  "type": "object",
  "required": ["meta", "names", "type_strings", "default_values"],
  "properties": {
    "meta": {
      "type": "object",
      "required": ["version"],
      "properties": {
        "version": {
          "type": "string", 
          "pattern": "^4\\.3$"
        },
        "generated": {
          "type": "string",
          "format": "date-time"
        },
        "project": {
          "type": "string"
        }
      }
    },
    "names": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Unified name dictionary"
    },
    "type_strings": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Pool for complex type annotations (List[str], Dict[int, str], etc.)"
    },
    "default_values": {
      "type": "array", 
      "items": {
        "type": "string"
      },
      "description": "Pool for default parameter values as string representations"
    },
    "modules": {
      "type": "array",
      "items": {
        "type": "array",
        "minItems": 3,
        "maxItems": 3,
        "items": [
          {
            "type": "integer",
            "description": "name_idx"
          },
          {
            "type": "integer", 
            "minimum": -1,
            "description": "parent_location_id (-1 = top-level)"
          },
          {
            "type": "integer",
            "minimum": 0,
            "description": "location_id"
          }
        ]
      }
    },
    "classes": {
      "type": "array",
      "items": {
        "type": "array",
        "minItems": 3,
        "maxItems": 3,
        "items": [
          {
            "type": "integer",
            "description": "name_idx"
          },
          {
            "type": "integer",
            "description": "parent_location_id"
          },
          {
            "type": "integer",
            "description": "location_id"
          }
        ]
      }
    },
    "functions": {
      "type": "array",
      "items": {
        "type": "array",
        "minItems": 3,
        "maxItems": 3,
        "items": [
          {
            "type": "integer",
            "description": "name_idx"
          },
          {
            "type": "integer",
            "description": "parent_location_id"
          },
          {
            "type": "integer",
            "description": "location_id"
          }
        ]
      }
    },
    "imports": {
      "type": "object",
      "patternProperties": {
        "^[0-9]+$": {
          "type": "array",
          "items": {
            "type": "integer",
            "description": "file_location_id"
          }
        }
      },
      "description": "Import mapping: module_name_idx -> [file_location_ids]"
    },
    "signatures": {
      "type": "object",
      "required": ["params_pool", "functions"],
      "properties": {
        "params_pool": {
          "type": "array",
          "items": {
            "type": "array",
            "items": {
              "type": "array",
              "minItems": 3,
              "maxItems": 4,
              "items": [
                {
                  "type": "integer",
                  "description": "param_name_idx"
                },
                {
                  "type": "integer",
                  "minimum": -1,
                  "description": "param_type_idx (-1 = no type)"
                },
                {
                  "type": "integer", 
                  "minimum": -1,
                  "description": "default_value_idx (-1 = no default)"
                },
                {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 3,
                  "description": "param_kind: 0=POSITIONAL, 1=KEYWORD, 2=VAR_POS, 3=VAR_KW"
                }
              ]
            }
          },
          "description": "Deduplicated parameter templates"
        },
        "functions": {
          "type": "array",
          "items": {
            "type": "array",
            "minItems": 3,
            "maxItems": 3,
            "items": [
              {
                "type": "integer",
                "description": "location_id"
              },
              {
                "type": "integer", 
                "minimum": -1,
                "description": "return_type_idx (-1 = no return type)"
              },
              {
                "type": "integer",
                "description": "params_pool_idx"
              }
            ]
          },
          "description": "Function signatures: [location_id, return_type_idx, params_pool_idx]"
        }
      }
    },
    "class_info": {
      "type": "object",
      "patternProperties": {
        "^[0-9]+$": {
          "type": "object",
          "properties": {
            "bases": {
              "type": "array",
              "items": {
                "type": "integer"
              },
              "description": "base_classes location_id"
            },
            "mro": {
              "type": "array", 
              "items": {
                "type": "integer"
              },
              "description": "Method resolution order (location_id)"
            },
            "methods": {
              "type": "array",
              "items": {
                "type": "integer"
              },
              "description": "location_id of class methods in definition order"
            },
            "decorators": {
              "type": "array",
              "items": {
                "type": "integer"
              },
              "description": "decorator_name_idx applied to class"
            }
          }
        }
      }
    },
    "external_dependencies": {
      "type": "array",
      "items": {
        "type": "integer"
      },
      "description": "name_idx of external modules (not found in project)"
    },
    "call_graph": {
      "type": "object",
      "patternProperties": {
        "^[0-9]+$": {
          "type": "array",
          "items": {
            "type": "integer"
          },
          "description": "caller_location_id -> [callee_location_ids]"
        }
      }
    },
    "decorators": {
      "type": "object",
      "patternProperties": {
        "^[0-9]+$": {
          "type": "array",
          "items": {
            "type": "integer"
          },
          "description": "function_location_id -> [decorator_name_idx]"
        }
      }
    },
    "attributes": {
      "type": "array",
      "items": {
        "type": "array",
        "minItems": 3,
        "maxItems": 3,
        "items": [
          {
            "type": "integer",
            "description": "name_idx"
          },
          {
            "type": "integer", 
            "description": "parent_location_id"
          },
          {
            "type": "integer",
            "minimum": -1,
            "description": "type_idx (-1 = no type)"
          }
        ]
      }
    }
  }
}